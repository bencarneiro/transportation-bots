
   
{% load static %}
<html>


    
<fieldset id="local">
    {% for key in local_routes %} 
    <input type="checkbox" id="{{key.route_id__route_id|safe}}" name="local" unchecked>
    <label for="scales">{{key.route_id__route_long_name}}</label>
  {% endfor %}
</fieldset>
<button onclick=selectLocal()>Select All Local Routes</button>
<button onclick=deselectLocal()>Deselect All Local Routes</button>


 <div style="width: 100%;"><canvas id="chart"></canvas></div>



 <script>

    var localRouteArray = []
    const localRoutes = document.querySelector("#local");
    localRoutes.addEventListener("change", (event) => {

        // if (!localRouteArray.includes(event.target.id)) {
        //     localRouteArray.push(event.target.id)
        // } else {
        //     localRouteArray = localRouteArray.filter(item => item !== event.target.id)
        // }
        // console.log(localRouteArray)
        var routes = getLocalRouteArray()
        refreshRidership(routes)
    });
    // const allLocalRoutes = document.querySelector("#all");
    function SelectAllLocalRoutes() {
        console.log("hi")
    }
    function selectLocal(){  
        var ele=document.getElementsByName('local');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=true;  
        }  
    }  
    function deselectLocal(){  
        var ele=document.getElementsByName('local');  
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox')  
                ele[i].checked=false;  
                
        }  
    } 
    function getLocalRouteArray(){  
        var ele=document.getElementsByName('local');  
        var localRouteArray = []
        for(var i=0; i<ele.length; i++){  
            if(ele[i].type=='checkbox' && ele[i].checked==true)  
                localRouteArray.push(ele[i].id)
        } 
        console.log(localRouteArray) 
        return(localRouteArray)
    }  

</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>

 
    <script>
        function addData(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

        function removeData(chart) {
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.pop();
            });
            chart.update();
        }

        function refreshRidership(routes) {
            chart = document.getElementById("chart")
            console.log(routes)
            ids = routes.join(",")
            console.log(ids)
            url = "/monthly_ridership/?route_id=" + ids
            // console.log(url)
            const pmtByMode = axios.get(url).then((resp) => {
                chart.remove()
                const pmtByMode = axios.get(url).then((resp) => {
                    const chart = new Chart(
                        document.getElementById('chart'),
                        {
                            type: 'line',
                            options: {
                                tooltips: {
                                callbacks: {
                                    label: function(tooltipItem, data) {
                                        return (
                                            new Intl.NumberFormat("en-US", {
                                                notation: "compact",
                                                compactDisplay: "short",
                                                }).format(tooltipItem.yLabel)
                                        )
                                    }
                                }
                            },
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            // Include a dollar sign in the ticks
                                            callback: function(value, index, ticks) {
                                                return (
                                                    new Intl.NumberFormat("en-US", {
                                                        notation: "compact",
                                                        compactDisplay: "short",
                                                        }).format(value)
                                                )
                                            }
                                        }
                                    }]
                                }
                            },
                            data: 
                            {
                                labels: resp.data.data.map(row => row.year),
                                datasets: [
                                {
                                    label: 'Riders',
                                    data: resp.data.data.map(row => row.riders),
                                    backgroundColor: "white",
                                    borderColor: "black"
                                },
                                ]
                            }
                        }
                    )
                })
                // addData(chart, resp.data.data, resp.data.data)
            })
        }


        var routes = getLocalRouteArray()
        ids = routes.join(",")
        console.log(ids)
        url = "/monthly_ridership/?route_id=" + ids
        console.log(url)
        const pmtByMode = axios.get(url).then((resp) => {
            const chart = new Chart(
                document.getElementById('chart'),
                {
                    type: 'line',
                    options: {
                        tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                return (
                                    new Intl.NumberFormat("en-US", {
                                        notation: "compact",
                                        compactDisplay: "short",
                                        }).format(tooltipItem.yLabel)
                                )
                            }
                        }
                    },
                        scales: {
                            yAxes: [{
                                ticks: {
                                    // Include a dollar sign in the ticks
                                    callback: function(value, index, ticks) {
                                        return (
                                            new Intl.NumberFormat("en-US", {
                                                notation: "compact",
                                                compactDisplay: "short",
                                                }).format(value)
                                        )
                                    }
                                }
                            }]
                        }
                    },
                    data: 
                    {
                        labels: resp.data.data.map(row => row.year),
                        datasets: [
                        {
                            label: 'Riders',
                            data: resp.data.data.map(row => row.riders),
                            backgroundColor: "white",
                            borderColor: "black"
                        },
                        ]
                    }
                }
            )
        })
    </script>
    </html>